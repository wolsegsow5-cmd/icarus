<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpSim Pro - Kesintisiz Lansman</title>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        :root {
            --primary: #14F195;
            --secondary: #9945FF;
            --bg: #131722;
            --panel: #1e222d;
            --text: #c5c6c7;
            --up-color: #26a69a;
            --down-color: #ef5350;
        }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        
        .header { width: 100%; max-width: 900px; display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--panel); border-radius: 12px; margin-bottom: 20px; box-sizing: border-box; }
        .logo { font-size: 1.5em; font-weight: bold; color: white; display: flex; align-items: center; gap: 10px; }
        .logo span { background: var(--primary); color: black; padding: 2px 8px; border-radius: 5px; font-size: 0.8em; }
        .wallet { background: #131722; padding: 10px 15px; border-radius: 8px; font-family: monospace; font-size: 1.2em; border: 1px solid #2a2e39; color: white; }
        
        .container { width: 100%; max-width: 900px; background: var(--panel); padding: 20px; border-radius: 12px; box-sizing: border-box; border: 1px solid #2a2e39; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        #setupScreen { display: block; text-align: center; padding: 50px 20px; }
        .input-group { margin: 25px 0; }
        input[type="text"] { width: 70%; padding: 15px; border-radius: 8px; border: 2px solid #2a2e39; background: #131722; color: white; font-size: 1.5em; text-align: center; outline: none; text-transform: uppercase; font-weight: bold; }
        input[type="text"]:focus { border-color: var(--primary); }
        .btn-launch { background: var(--primary); color: #000; font-weight: bold; font-size: 1.3em; padding: 15px 50px; border: none; border-radius: 8px; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn-launch:hover { background: #10c97c; transform: translateY(-2px); }

        #marketScreen { display: none; }
        .market-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; }
        .coin-info { text-align: left; }
        .coin-title { font-size: 2em; font-weight: 900; color: white; margin-bottom: 5px;}
        .price-display { font-size: 1.8em; color: var(--up-color); font-family: monospace; font-weight: bold; }
        
        #tvchart { width: 100%; height: 450px; background: #131722; border: 1px solid #2a2e39; border-radius: 8px; overflow: hidden; }

        .action-panel { display: flex; gap: 15px; margin-top: 20px; }
        .trade-box { flex: 1; background: #131722; padding: 20px; border-radius: 8px; border: 1px solid #2a2e39; text-align: center; }
        .btn { width: 100%; padding: 15px; font-size: 1.2em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; color: white; text-transform: uppercase; margin-top: 10px; transition: 0.2s;}
        .btn-buy { background: var(--up-color); }
        .btn-buy:hover { background: #33b5a5; transform: scale(1.02); }
        .btn-sell { background: var(--down-color); }
        .btn-sell:hover { background: #f0625d; transform: scale(1.02); }
        
        .balance-info { font-size: 1em; color: #aaa; }
        .highlight { color: var(--secondary); font-weight: bold; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo">ðŸ’Š PumpSim <span>PRO</span></div>
        <div class="wallet">Bakiye: <span id="cash" style="color: var(--primary);">2000.00</span> $</div>
    </div>

    <div class="container" id="setupScreen">
        <h2 style="color: white; font-size: 2em; margin-bottom: 5px;">ðŸš€ Projeyi BaÅŸlat</h2>
        <p style="color: #888;">TradingView destekli Pump.fun simÃ¼lasyonu</p>
        <div class="input-group">
            <input type="text" id="tokenName" value="PUMA" placeholder="Ã–rn: DUCKCOIN" autocomplete="off" maxlength="10">
        </div>
        <button class="btn-launch" onclick="startMarket()">Piyasaya SÃ¼r</button>
    </div>

    <div class="container" id="marketScreen">
        <div class="market-header">
            <div class="coin-info">
                <div class="coin-title" id="marketTokenName">COIN / USD</div>
                <div class="balance-info" id="tokenBalanceDisplay">CÃ¼zdan: <span class="highlight">0.00</span> Adet</div>
            </div>
            <div class="price-display">$<span id="tokenPrice">0.001000</span></div>
        </div>
        
        <div id="tvchart"></div>

        <div class="action-panel">
            <div class="trade-box">
                <div class="balance-info">AlÄ±nacak Tutar: $100</div>
                <button class="btn btn-buy" onclick="executeBuy()">AL</button>
            </div>
            <div class="trade-box">
                <div class="balance-info">TÃ¼mÃ¼nÃ¼ Sat</div>
                <button class="btn btn-sell" onclick="executeSell()">SAT</button>
            </div>
        </div>
    </div>

<script>
    let cashBalance = 2000.00;
    let tokensOwned = 0;
    let currentPrice = 0.001000; 
    let activeToken = "";
    
    // Grafik ve Zaman DeÄŸiÅŸkenleri
    let chart;
    let candleSeries;
    let volumeSeries;
    let currentCandle;
    let currentVolume = 0;
    // Ã‡Ã¶kmeyi Ã¶nlemek iÃ§in sanal zaman kullanÄ±yoruz
    let currentTimeStamp = Math.floor(Date.now() / 1000); 

    function refreshUI() {
        document.getElementById('cash').innerText = cashBalance.toFixed(2);
        
        let priceEl = document.getElementById('tokenPrice');
        priceEl.innerText = currentPrice.toFixed(6);
        // Fiyata gÃ¶re renk deÄŸiÅŸtir
        priceEl.style.color = currentCandle.close >= currentCandle.open ? 'var(--up-color)' : 'var(--down-color)';
        
        document.getElementById('tokenBalanceDisplay').innerHTML = `CÃ¼zdan: <span class="highlight">${tokensOwned.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span> ${activeToken}`;
    }

    function startMarket() {
        const inputVal = document.getElementById('tokenName').value.trim();
        activeToken = inputVal === "" ? "TOKEN" : inputVal.toUpperCase();
        
        document.getElementById('marketTokenName').innerText = activeToken + " / USD";
        document.getElementById('setupScreen').style.display = 'none';
        document.getElementById('marketScreen').style.display = 'block';

        initTradingViewChart();
        refreshUI();
        
        // ZamanlayÄ±cÄ±lar (Bot iÅŸlemleri ve mum kapatma)
        setInterval(autoMoveMarket, 2000); // Her 2 saniyede bir ufak dalgalanma
        setInterval(createNewCandle, 5000); // Her 5 saniyede bir yeni mum aÃ§Ä±lÄ±r
    }

    function initTradingViewChart() {
        const chartContainer = document.getElementById('tvchart');
        
        chart = LightweightCharts.createChart(chartContainer, {
            width: chartContainer.clientWidth,
            height: 450,
            layout: { background: { type: 'solid', color: '#131722' }, textColor: '#d1d4dc' },
            grid: { vertLines: { color: '#2a2e39' }, horzLines: { color: '#2a2e39' } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: { timeVisible: true, secondsVisible: true },
        });

        // 1. Mum Serisi (Candlestick)
        candleSeries = chart.addCandlestickSeries({
            upColor: '#26a69a', downColor: '#ef5350', borderDownColor: '#ef5350', borderUpColor: '#26a69a', wickDownColor: '#ef5350', wickUpColor: '#26a69a',
        });

        // 2. Hacim Serisi (Volume Histogram)
        volumeSeries = chart.addHistogramSeries({
            color: '#26a69a',
            priceFormat: { type: 'volume' },
            priceScaleId: '', 
            scaleMargins: { top: 0.8, bottom: 0 }, // Hacmi grafiÄŸin en altÄ±na sÄ±kÄ±ÅŸtÄ±rÄ±r
        });

        // Verileri baÅŸlat
        currentCandle = { time: currentTimeStamp, open: currentPrice, high: currentPrice, low: currentPrice, close: currentPrice };
        candleSeries.setData([currentCandle]);
        volumeSeries.setData([{ time: currentTimeStamp, value: currentVolume, color: '#26a69a' }]);
    }

    function updatePrice(newPrice, addVolume) {
        currentPrice = newPrice;
        currentVolume += addVolume;
        
        // Mumu gÃ¼ncelle
        currentCandle.close = currentPrice;
        if (currentPrice > currentCandle.high) currentCandle.high = currentPrice;
        if (currentPrice < currentCandle.low) currentCandle.low = currentPrice;
        candleSeries.update(currentCandle);
        
        // Hacmi gÃ¼ncelle (YeÅŸil veya KÄ±rmÄ±zÄ±)
        let vColor = currentCandle.close >= currentCandle.open ? '#26a69a' : '#ef5350';
        volumeSeries.update({ time: currentTimeStamp, value: currentVolume, color: vColor });
        
        refreshUI();
    }

    function createNewCandle() {
        // Yeni muma geÃ§erken zamanÄ± kesin olarak 5 saniye ileri al (Ã‡Ã¶kme sorununu Ã§Ã¶zer)
        currentTimeStamp += 5; 
        currentVolume = 0; // Yeni mum iÃ§in hacmi sÄ±fÄ±rla

        currentCandle = { time: currentTimeStamp, open: currentPrice, high: currentPrice, low: currentPrice, close: currentPrice };
        candleSeries.update(currentCandle);
        volumeSeries.update({ time: currentTimeStamp, value: currentVolume, color: '#26a69a' });
    }

    function executeBuy() {
        if (cashBalance >= 100) {
            let received = 100 / currentPrice;
            cashBalance -= 100;
            tokensOwned += received;
            
            // Pump etkisi (%3 ile %10 arasÄ± sert yÃ¼kseliÅŸ)
            let newPrice = currentPrice * (1 + (Math.random() * 0.07 + 0.03)); 
            updatePrice(newPrice, 5000); // 5000 birimlik fake hacim ekle
        } else {
            alert("Bakiye yetersiz! BankayÄ± soymadÄ±n sonuÃ§ta.");
        }
    }

    function executeSell() {
        if (tokensOwned > 0) {
            let cashEarned = tokensOwned * currentPrice;
            cashBalance += cashEarned;
            tokensOwned = 0;
            
            // Dump etkisi (%5 ile %15 arasÄ± sert dÃ¼ÅŸÃ¼ÅŸ)
            let newPrice = currentPrice * (1 - (Math.random() * 0.10 + 0.05));
            if(newPrice < 0.000001) newPrice = 0.000001; 
            updatePrice(newPrice, 7000); // SatÄ±ÅŸ baskÄ±sÄ± iÃ§in daha yÃ¼ksek hacim Ã§ubuÄŸu
        } else {
            alert("SatÄ±lacak token yok! Ã–nce biraz almalÄ±sÄ±n.");
        }
    }

    function autoMoveMarket() {
        // DoÄŸal dalgalanma motoru (Botlar al-sat yapÄ±yor)
        let volatility = 1 + (Math.random() * 0.016 - 0.008); // %0.8 yukarÄ± veya aÅŸaÄŸÄ±
        let botVolume = Math.floor(Math.random() * 500) + 100; // Ufak bot hacmi
        updatePrice(currentPrice * volatility, botVolume);
    }
</script>

</body>
</html>
